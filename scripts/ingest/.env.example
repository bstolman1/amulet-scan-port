# --------------------------------------------
# Canton Scan API
# --------------------------------------------
SCAN_URL=https://scan.sv-1.global.canton.network.sync.global/api/scan

# --------------------------------------------
# DATA PATHS (Local mode only)
# Windows:  DATA_DIR=C:\ledger_raw
# Linux/VM: DATA_DIR=/home/YOUR_USERNAME/ledger_data
# 
# Note: When GCS_BUCKET is set, Parquet files are written to /tmp/ledger_raw
# and uploaded to GCS. DATA_DIR is still used for cursors.
# --------------------------------------------
DATA_DIR=/home/YOUR_USERNAME/ledger_data
CURSOR_DIR=/home/YOUR_USERNAME/ledger_data/cursors

# --------------------------------------------
# GOOGLE CLOUD STORAGE (GCP mode - ENABLED BY DEFAULT)
# When GCS_BUCKET is set, all data is written to /tmp, 
# uploaded to GCS, then deleted locally. Keeps disk usage flat.
# The VM must have a service account with GCS write permissions.
# Set GCS_ENABLED=false to force local disk mode even with bucket set.
# --------------------------------------------
GCS_BUCKET=your-bucket-name
# GCS_ENABLED=false  # Uncomment to force local mode

# Retry configuration for GCS uploads (exponential backoff)
# GCS_MAX_RETRIES=3           # Maximum retry attempts (default: 3)
# GCS_RETRY_BASE_DELAY_MS=1000  # Base delay in ms (default: 1000)
# GCS_RETRY_MAX_DELAY_MS=30000  # Max delay between retries (default: 30000)

# GCS Crash Safety - Checkpoint interval for GCS confirmation
# Every N batches, drain the upload queue and confirm the GCS cursor position.
# Lower = safer (smaller re-fetch window on crash) but slower
# Higher = faster but larger data loss window on VM crash
# Default: 50 batches (~50K updates, ~30 sec re-fetch on crash)
GCS_CHECKPOINT_INTERVAL=50

# --------------------------------------------
# FETCHER SETTINGS (with adaptive rate limiting)
# --------------------------------------------
PARALLEL_FETCHES=8
MIN_PARALLEL_FETCHES=2
MAX_PARALLEL_FETCHES=24

# Latency thresholds for auto-tuning (milliseconds)
LATENCY_LOW_MS=500
LATENCY_HIGH_MS=2000
LATENCY_CRITICAL_MS=5000

BATCH_SIZE=1000

# --------------------------------------------
# WORKER THREAD SETTINGS
# --------------------------------------------
MAX_WORKERS=12

# Larger chunks = fewer ZSTD flushes = higher throughput
CHUNK_SIZE=4096

# --------------------------------------------
# MEMORY MANAGEMENT (Heap-Aware Throttling)
# Prevents OOM crashes by pausing ingestion when heap usage is high
# --------------------------------------------
# Pause and drain queues when heap exceeds this fraction of max
# HEAP_PRESSURE_THRESHOLD=0.80

# Emergency threshold - more aggressive draining
# HEAP_CRITICAL_THRESHOLD=0.90

# Minimum interval between heap checks (ms) - reduces overhead
# HEAP_CHECK_INTERVAL_MS=5000

# --------------------------------------------
# COMPRESSION SETTINGS
# --------------------------------------------
ZSTD_LEVEL=2
IO_BUFFER_SIZE=1048576

# --------------------------------------------
# FILE MANAGEMENT
# --------------------------------------------
MAX_ROWS_PER_FILE=20000
FLUSH_INTERVAL_MS=0

# --------------------------------------------
# OPTIONAL: Groups.io API (for governance announcements)
# --------------------------------------------
# GROUPS_IO_API_KEY=your_api_key_here
